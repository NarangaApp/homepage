
import React, { useState, useMemo } from 'react';

interface Point {
  x: number;
  y: number;
  size: number;
  opacity: number;
}

interface TechNode {
  id: number;
  title: string;
  desc: string;
  imageUrl: string;
  x: number;
  y: number;
  satellites: Point[]; 
  connections: number[]; // 연결된 다른 노드의 ID
  status: string;
}

const AwardsSection: React.FC = () => {
  const [hoveredId, setHoveredId] = useState<number | null>(null);
  const [hasInteracted, setHasInteracted] = useState(false);

  // 1. 핵심 기술 노드 정의 (인증 및 특허 데이터 반영)
  const techNodes: TechNode[] = useMemo(() => {
    const rawNodes = [
      { 
        id: 1, 
        title: "기업부설연구소 인정", 
        desc: "미래 모빌리티 및 AI 판단 엔진 개발 역량 공식 인증 (과기부)", 
        x: 50, y: 50, 
        img: "https://images.unsplash.com/photo-1621243804936-775306a8f2e3?auto=format&fit=crop&q=80&w=400", 
        conn: [2, 3, 4, 8],
        status: "OFFICIAL"
      },
      { 
        id: 2, 
        title: "중고차 가격산출 서버", 
        desc: "AI 기반 차량 상태 및 시장 트렌드 실시간 분석 특허 등록", 
        x: 22, y: 25, 
        img: "https://images.unsplash.com/photo-1589330273594-fade1ee91647?auto=format&fit=crop&q=80&w=400", 
        conn: [1, 3, 8],
        status: "REGISTERED"
      },
      { 
        id: 3, 
        title: "자동차 유전자 AI 지도", 
        desc: "차량 정비 데이터 기반 고장 사전 예측 데이터 제공 시스템 특허", 
        x: 78, y: 20, 
        img: "https://images.unsplash.com/photo-1562654501-a0ccc0af3fb1?auto=format&fit=crop&q=80&w=400", 
        conn: [1, 2, 4],
        status: "REGISTERED"
      },
      { 
        id: 4, 
        title: "OCV 배터리 진단", 
        desc: "OCV 기반 배터리 상태 진단 시스템 및 알고리즘 출원", 
        x: 88, y: 50, 
        img: "https://images.unsplash.com/photo-1593941707882-a5bba14938c7?auto=format&fit=crop&q=80&w=400", 
        conn: [3, 1, 5],
        status: "PENDING"
      },
      { 
        id: 5, 
        title: "차량 상태 증강현실(AR)", 
        desc: "AI 활용 자동차 상태 기반 AR 시각화 동작방법 출원", 
        x: 70, y: 80, 
        img: "https://images.unsplash.com/photo-1478416402424-8113650228d1?auto=format&fit=crop&q=80&w=400", 
        conn: [4, 6],
        status: "PENDING"
      },
      { 
        id: 6, 
        title: "허위매물 조회 서비스", 
        desc: "AI 기반 중고차 허위매물 식별 및 실시간 조회 시스템 출원", 
        x: 30, y: 82, 
        img: "https://images.unsplash.com/photo-1554224155-169641357599?auto=format&fit=crop&q=80&w=400", 
        conn: [5, 7],
        status: "PENDING"
      },
      { 
        id: 7, 
        title: "실시간 멀티 스캐너", 
        desc: "AI 기반 차량 멀티 스캐너 실시간 차량진단 기술 출원", 
        x: 12, y: 55, 
        img: "https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?auto=format&fit=crop&q=80&w=400", 
        conn: [6, 8],
        status: "PENDING"
      },
      { 
        id: 8, 
        title: "가격산출 동작 알고리즘", 
        desc: "중고차 적정가격 산출 서비스 동작 프로세스 기술 출원", 
        x: 48, y: 15, 
        img: "https://images.unsplash.com/photo-1450101499163-c8848c66ca85?auto=format&fit=crop&q=80&w=400", 
        conn: [1, 2, 7],
        status: "PENDING"
      }
    ];

    return rawNodes.map(node => {
      const satellites: Point[] = Array.from({ length: 18 + Math.floor(Math.random() * 10) }).map(() => {
        const angle = Math.random() * Math.PI * 2;
        const radius = 10 + Math.random() * 55; 
        return {
          x: node.x + Math.cos(angle) * radius,
          y: node.y + Math.sin(angle) * radius,
          size: Math.random() * 0.18 + 0.05,
          opacity: Math.random() * 0.18 + 0.03,
        };
      });
      return { ...node, imageUrl: node.img, satellites, connections: node.conn };
    });
  }, []);

  const handleMouseEnter = (id: number) => {
    setHoveredId(id);
    if (!hasInteracted) setHasInteracted(true);
  };

  return (
    <section id="tech-certification" className="py-40 bg-[#040406] relative overflow-hidden min-h-[1200px] flex items-center justify-center">
      
      {/* Background Deep Glow */}
      <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,#0C1222_0%,transparent_85%)] opacity-60 pointer-events-none" />

      <div className="container mx-auto px-6 relative z-10 h-full flex flex-col">
        
        {/* Header */}
        <div className="mb-32 text-center">
          <div className="flex items-center justify-center gap-8 mb-12 opacity-40">
             <div className="w-24 h-px bg-gradient-to-r from-transparent to-[#0066ff]" />
             <span className="text-white font-black text-xs tracking-[1.5em] uppercase">Core Expertise & IP</span>
             <div className="w-24 h-px bg-gradient-to-l from-transparent to-[#0066ff]" />
          </div>
          <h2 className="text-5xl md:text-8xl font-black text-white tracking-tighter leading-tight">
            독보적인 기술과 <br />
            <span className="inline-block text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-[#0066ff] italic pr-8 md:pr-12">특허 포트폴리오</span>
          </h2>
        </div>

        <div className="relative w-full max-w-6xl aspect-[16/9] mx-auto flex-grow">
          
          {/* Interaction Hint */}
          <div className={`absolute top-0 right-0 z-[110] transition-all duration-700 pointer-events-none ${
            hasInteracted ? 'opacity-0 -translate-y-4 invisible' : 'opacity-100 translate-y-0 visible'
          }`}>
             <div className="flex items-center gap-4 bg-white/5 backdrop-blur-xl border border-white/10 px-6 py-4 rounded-3xl animate-bounce-subtle">
                <div className="w-10 h-10 bg-[#0066ff] rounded-2xl flex items-center justify-center text-white shadow-lg">
                   <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" />
                   </svg>
                </div>
                <div className="flex flex-col">
                   <span className="text-white/60 font-bold text-[13px] leading-none">노드에 마우스를 올려 기술 내용을 확인하세요</span>
                </div>
             </div>
          </div>

          <svg 
            viewBox="0 0 100 100" 
            preserveAspectRatio="none" 
            className="absolute inset-0 w-full h-full pointer-events-none overflow-visible"
          >
            {/* Neural Connections Layer */}
            {techNodes.map((node) => 
              node.connections.map(targetId => {
                const target = techNodes.find(n => n.id === targetId);
                if (!target || node.id > targetId) return null; 
                
                const isPathActive = hoveredId === node.id || hoveredId === targetId;
                
                return (
                  <g key={`mesh-${node.id}-${targetId}`}>
                    <line 
                      x1={node.x} y1={node.y}
                      x2={target.x} y2={target.y}
                      stroke={isPathActive ? "rgba(0, 102, 255, 0.6)" : "rgba(0, 102, 255, 0.04)"}
                      strokeWidth={isPathActive ? "0.3" : "0.06"}
                      className="transition-all duration-700"
                    />
                  </g>
                );
              })
            )}

            {/* Individual Node Satellite Edges */}
            {techNodes.map((node) => {
              const isActive = hoveredId === node.id;
              return node.satellites.map((sat, sIdx) => (
                <line 
                  key={`line-${node.id}-${sIdx}`}
                  x1={node.x} y1={node.y}
                  x2={sat.x} y2={sat.y}
                  stroke={isActive ? "#0066ff" : "rgba(0, 102, 255, 0.08)"}
                  strokeWidth={isActive ? "0.15" : "0.02"}
                  strokeOpacity={isActive ? 0.5 : 0.06}
                  className="transition-all duration-700 ease-out"
                />
              ));
            })}

            {/* Neural Satellites */}
            {techNodes.map((node) => 
              node.satellites.map((sat, sIdx) => (
                <circle 
                  key={`sat-${node.id}-${sIdx}`}
                  cx={sat.x} cy={sat.y}
                  r={sat.size}
                  fill="white"
                  fillOpacity={hoveredId === node.id ? 0.75 : sat.opacity}
                  className="transition-opacity duration-700"
                />
              ))
            )}
          </svg>

          {/* Hub Nodes */}
          {techNodes.map((node) => {
            const isActive = hoveredId === node.id;
            const isOnRightSide = node.x > 50;

            return (
              <div 
                key={node.id}
                className={`absolute -translate-x-1/2 -translate-y-1/2 group transition-all duration-300 ${
                  isActive ? 'z-[100]' : 'z-[50]'
                }`}
                style={{ left: `${node.x}%`, top: `${node.y}%` }}
                onMouseEnter={() => handleMouseEnter(node.id)}
                onMouseLeave={() => setHoveredId(null)}
              >
                <div className="relative flex items-center justify-center">
                  
                  {/* Glowing Aura */}
                  <div className={`absolute inset-0 rounded-full blur-[50px] transition-all duration-1000 pointer-events-none ${
                    isActive ? 'bg-[#0066ff]/30 scale-[7]' : 'bg-transparent'
                  }`} />

                  {/* Numbered Hub Circle */}
                  <div className={`w-12 h-12 md:w-16 md:h-16 rounded-full border flex items-center justify-center transition-all duration-500 z-10 cursor-pointer ${
                    isActive 
                      ? 'bg-[#0066ff] border-blue-300 scale-125 shadow-[0_0_80px_rgba(0,102,255,1)]' 
                      : 'bg-blue-950/20 border-[#0066ff]/50 hover:border-blue-400 hover:scale-110 shadow-[0_0_25px_rgba(0,102,255,0.2)]'
                  }`}>
                    <span className={`text-sm md:text-lg font-black italic tracking-tighter transition-colors ${
                      isActive ? 'text-white' : 'text-blue-300'
                    }`}>
                      0{node.id}
                    </span>
                  </div>

                  {/* Description Card */}
                  <div className={`absolute top-1/2 -translate-y-1/2 w-[280px] md:w-[320px] bg-white rounded-[2rem] shadow-[0_40px_100px_-15px_rgba(0,0,0,0.5)] transition-all duration-500 pointer-events-none z-[1000] border border-gray-100 ${
                    isActive ? 'opacity-100 translate-x-0' : 'opacity-0 translate-y-8 invisible'
                  } ${
                    isOnRightSide ? 'right-full mr-12' : 'left-full ml-12'
                  }`}>
                    <div className="px-8 pt-8 pb-8">
                      {/* Status Badge */}
                      <div className="mb-4">
                        <span className={`px-2.5 py-1 text-white text-[8px] font-black rounded-full uppercase tracking-[0.2em] shadow-lg bg-[#0066ff]`}>
                          {node.status} IP
                        </span>
                      </div>

                      <div className="flex items-center gap-3 mb-4">
                        <div className={`w-1 h-5 rounded-full shadow-[0_0_12px_rgba(0,102,255,0.4)] bg-[#0066ff]`} />
                        <h4 className="text-gray-950 font-black text-lg tracking-tight leading-tight">{node.title}</h4>
                      </div>

                      <p className="text-gray-500 text-[13px] font-bold leading-relaxed mb-4">
                        {node.desc}
                      </p>

                    </div>
                  </div>
                </div>
              </div>
            );
          })}
        </div>

      </div>

      <style>{`
        #tech-certification::after {
          content: '';
          position: absolute;
          inset: 0;
          background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.01) 1px, transparent 0);
          background-size: 60px 60px;
          pointer-events: none;
        }
        @keyframes bounce-subtle {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-8px); }
        }
        .animate-bounce-subtle {
          animation: bounce-subtle 3s ease-in-out infinite;
        }
      `}</style>
    </section>
  );
};

export default AwardsSection;
